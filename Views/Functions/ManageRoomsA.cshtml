@model IEnumerable<BRMSBS_capstoneproject.Models.RoomModel>

@{
    ViewData["Title"] = "Manage Rooms";
    Layout = "~/Views/Layouts/ManageRmLayoutA.cshtml";

    // Count occupied and available rooms
    var occupiedCount = Model?.Count(r => r.Status?.ToLower() == "occupied") ?? 0;
    var availableCount = Model?.Count(r => r.Status?.ToLower() == "available") ?? 0;
    var reservedCount = Model?.Count(r => r.Status?.ToLower() == "reserved") ?? 0;
    var maintainanceCount = Model?.Count(r => r.Status?.ToLower() == "maintainance") ?? 0;
}

<div class="text-ctr"><b> Manage your rooms </b></div>

<div class="containerbox">
    <h5>Created Rooms: @Model.Count() | Available Rooms: @availableCount | Occupied Rooms: @occupiedCount <br/> Reserved Rooms @reservedCount | Maintainance Rooms: @maintainanceCount </h5><br/>

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createRoomModal">Create Room    </button><br />

    *Action buttons are disabled when the room status is occupied and reserved.<br/>
    *When status is Maintainance, click "Set as Active" to room is ready.
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Room Number</th>
                <th>Room Type</th>
                <th>Price</th>
                <th>Capacity</th>
                <th>Room Status</th>
				<th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                @foreach (var room in Model)
                {
                    var isOccupied = room.Status?.ToLower() == "occupied";
                    var isReserved = room.Status?.ToLower() == "reserved";
                    var isMaintainance = room.Status?.ToLower() == "maintainance";
                    var isAvailable = room.Status?.ToLower() == "available";
                    <tr>
                        <td>@room.RoomNumber</td>
                        <td>@room.RoomType</td>
                        <td>@room.RoomPrice</td>
                        <td>@room.RoomCapacity</td>
                        <td id="room-status-@room.Id">@room.Status</td>
                        <td>
                            <button type="button"
                                    class="btn btn-sm btn-outline-warning"
                                    data-bs-toggle="modal"
                                    data-bs-target="#editRoomModal"
                                    data-roomid="@room.Id"
                                    data-roomnumber="@room.RoomNumber"
                                    data-roomtype="@room.RoomType"
                                    data-roomprice="@room.RoomPrice"
                                    data-roomcapacity="@room.RoomCapacity"
                                    @(isOccupied ? "disabled" : "")
                                    @(isMaintainance ? "disabled" : "")
                                    @(isReserved ? "disabled" : "")>
                                Edit
                            </button>
                            <button type="button"
                                    class="btn btn-sm btn-outline-danger ms-1"
                                    data-bs-toggle="modal"
                                    data-bs-target="#deleteRoomModal"
                                    data-roomid="@room.Id"
                                    data-roomnumber="@room.RoomNumber"
                                    data-roomtype="@room.RoomType"
                                    @(isOccupied ? "disabled" : "")
                                    @(isMaintainance ? "disabled" : "")
                                    @(isReserved ? "disabled" : "")>
                                Delete
                            </button>
                            <form method="post" action="/System/SetRoomAsAvailable" style="display:inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="Id" value="@room.Id" />
                                <button type="submit"
                                     class="btn btn-sm btn-outline-success ms-1"
                                     @(isAvailable ? "disabled" : "")
                                     @(isOccupied ? "disabled" : "")
                                     @(isReserved ? "disabled" : "")>
                                    Set as Active
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="6" class="text-center">No rooms created.</td>
                </tr>
            }
        </tbody>
    </table>
</div>





<!-- Create Room and Room Type Modal -->
<div class="modal fade" id="createRoomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="/System/CreateRoomNRoomType">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="createAccountModalLabel">Create Room Number and Room Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Room Number</label>
                        <input type="text" class="form-control" id="roomnumber" name="RoomNumber" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Room Type</label>
                        <select class="form-select" id="roomtype" name="RoomType" required>
                            <option value="">- Select Room Type -</option>
                            <option value="Standard">Standard</option>
                            <option value="Deluxe">Deluxe</option>
                            <option value="Premium">Premium</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price</label>
                        <input type="number" class="form-control" id="roomprice" name="RoomPrice" step="0.01" min="0" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Capacity</label>
                        <input type="number" class="form-control" id="roomcapacity" name="RoomCapacity" step="1" min="1" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Create Room</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Success Popup Modal for Created Room and Room Type -->
<div class="modal fade" id="successRoomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Success!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                Your Room and Room Type has been added
            </div>
        </div>
    </div>
</div>

<!-- Edit Room and Room Type Modal -->
<div class="modal fade" id="editRoomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="/System/EditRoomNRoomType">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="editRoomModalLabel">Edit Room and Room Type</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editRoomId" name="Id" />
                    <div class="mb-3">
                        <label class="form-label">Room Number</label>
                        <input type="text" class="form-control" id="editRoomNumber" name="RoomNumber" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Room Type</label>
                        <select class="form-select" id="editRoomType" name="RoomType" required>
                            <option value="">- Select Room Type -</option>
                            <option value="Standard">Standard</option>
                            <option value="Deluxe">Deluxe</option>
                            <option value="Premium">Premium</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price</label>
                        <input type="number" class="form-control" id="editRoomPrice" name="RoomPrice" step="0.01" min="0" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Capacity</label>
                        <input type="number" class="form-control" id="editRoomCapacity" name="RoomCapacity" step="1" min="1" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-warning">Save Changes</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Success Popup Modal for Edit Room and Room Type -->
<div class="modal fade" id="successEditModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Success!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                Your Room and Room Type has been updated
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div class="modal fade" id="deleteRoomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="/System/DeleteRoomNRoomType">
                @Html.AntiForgeryToken()
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteRoomModalLabel">Delete Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="deleteRoomId" name="Id" />
                    <p>Are you sure you want to delete the room and your room type? <b id="deleteRoomNumber"></b>?</p>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Delete</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Success Popup Modal for Delete -->
<div class="modal fade" id="successDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Success!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                Your Room and Room Type has been deleted
            </div>
        </div>
    </div>
</div>

<!-- Success Popup Modal for Set as Active -->
<div class="modal fade" id="successSetActiveModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Success!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                The selected room is ready
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Show success modal if room was created
        window.addEventListener('DOMContentLoaded', function () {
            @if (TempData["RoomCreated"] != null)
            {
                <text>
                var successModal = new bootstrap.Modal(document.getElementById('successRoomModal'));
                successModal.show();
                setTimeout(function () {
                    successModal.hide();
                }, 3000);
                </text>
            }
            @if (TempData["RoomEdited"] != null)
            {
                    <text>
                    var successEditModal = new bootstrap.Modal(document.getElementById('successEditModal'));
                    successEditModal.show();
                    setTimeout(function () {
                        successEditModal.hide();
                    }, 3000);
                    </text>
            }
            @if (TempData["RoomDeleted"] != null)
            {
                    <text>
                    var successDeleteModal = new bootstrap.Modal(document.getElementById('successDeleteModal'));
                    successDeleteModal.show();
                    setTimeout(function () {
                        successDeleteModal.hide();
                    }, 3000);
                    </text>
            }
            @if (TempData["RoomActivated"] != null)
            {
                    <text>
                    var successSetActiveModal = new bootstrap.Modal(document.getElementById('successSetActiveModal'));
                    successSetActiveModal.show();
                    setTimeout(function () {
                        successSetActiveModal.hide();
                    }, 3000);
                    </text>
            }
        });

        // Populate Edit Room Modal with room data
        var editRoomModal = document.getElementById('editRoomModal');
        editRoomModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var roomId = button.getAttribute('data-roomid');
            var roomNumber = button.getAttribute('data-roomnumber');
            var roomType = button.getAttribute('data-roomtype');
            var roomPrice = button.getAttribute('data-roomprice');
            var roomCapacity = button.getAttribute('data-roomcapacity');

            var modalRoomId = editRoomModal.querySelector('#editRoomId');
            var modalRoomNumber = editRoomModal.querySelector('#editRoomNumber');
            var modalRoomType = editRoomModal.querySelector('#editRoomType');
            var modalRoomPrice = editRoomModal.querySelector('#editRoomPrice');
            var modalRoomCapacity = editRoomModal.querySelector('#editRoomCapacity');

            modalRoomId.value = roomId;
            modalRoomNumber.value = roomNumber;
            // Set the selected value for the dropdown
            for (var i = 0; i < modalRoomType.options.length; i++) {
                if (modalRoomType.options[i].value === roomType) {
                    modalRoomType.selectedIndex = i;
                    break;
                }
            }
            modalRoomPrice.value = roomPrice ?? '';
            modalRoomCapacity.value = roomCapacity ?? '';
        });

         // Populate Delete Room Modal with room data
        var deleteRoomModal = document.getElementById('deleteRoomModal');
        deleteRoomModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var roomId = button.getAttribute('data-roomid');
            var roomNumber = button.getAttribute('data-roomnumber');

            var modalRoomId = deleteRoomModal.querySelector('#deleteRoomId');
            var modalRoomNumber = deleteRoomModal.querySelector('#deleteRoomNumber');

            modalRoomId.value = roomId;
            modalRoomNumber.textContent = roomNumber;
        });
    </script>
}

